<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashboard - SB Admin</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link href="/css/styles.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
</head>

<body class="sb-nav-fixed">
    <!-- header section here -->
    <%-include('./layouts/nav.ejs')%>
        <!-- header end -->
        <div id="layoutSidenav">
            <!-- sidenav -->
            <%-include('./layouts/sidebar.ejs')%>
                <!-- sidenav end -->
                <div id="layoutSidenav_content">
                    <main>
                        <div class="container-fluid px-4">
                            <h1 class="mt-4">Question List</h1>
                                                        <!-- Add this to your <head> if not already present -->
                            <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
                            
                            <!-- ...existing HTML... -->
                            
                            <div class="table-responsive">
                              <table id="questionsTable" class="table table-bordered table-striped">
                                <thead class="table-dark">
                                  <tr>
                                    <th>Exam Name</th>
                                    <th>Question</th>
                                    <th>Options</th>
                                    <th>Correct Answer</th>
                                    <th>Marks</th>
                                    <th>Action</th>
                                  </tr>
                                </thead>
                                <tbody id="questionTableBody">
                                  <!-- Dynamic rows will be inserted here -->
                                </tbody>
                              </table>
                            </div>
                            
                            <!-- ...modal and other content... -->
                            
                            <!-- Scripts at the end of body -->
                            <script src="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2" ></script>
                            <script>
                            $(document).ready(function () {
                                function fetchQuestions() {
                                    $.ajax({
                                        url: '/admin/question',
                                        type: 'GET',
                                        success: function (response) {
                                            let html = '';
                                            if (response.status && response.data.length > 0) {
                                                for (const question of response.data) {
                                                    html += `
                                                        <tr>
                                                            <td>${question.exam.name}</td>
                                                            <td>${question.questionText}</td>
                                                            <td>${question.options.join(' , ')}</td>
                                                            <td>${question.options[Number(question.correctAnswer) - 1]}</td>
                                                            <td>${question.marks}</td>
                                                            <td class="text-center">
                                                                <button class="btn btn-sm btn-warning me-1 edit-btn" data-exam-id="${question._id}">Edit</button>
                                                                <button class="btn btn-sm btn-danger delete-btn" data-exam-id="${question._id}">Delete</button>
                                                            </td>
                                                        </tr>
                                                    `;
                                                }
                                            } else {
                                                html = '<tr><td colspan="6">No Questions found</td></tr>';
                                            }
                                            $('#questionTableBody').html(html);
                            
                                            // Destroy previous DataTable instance if exists
                                            if (window.questionsDataTable) {
                                                window.questionsDataTable.destroy();
                                            }
                                            // Initialize DataTable with pagination, search, and sort
                                            window.questionsDataTable = new simpleDatatables.DataTable("#questionsTable", {
                                                perPage: 5,
                                                perPageSelect: [5, 10, 20, 50],
                                                searchable: true,
                                                sortable: true,
                                                labels: {
                                                    placeholder: "Search...",
                                                    perPage: "{select} rows per page",
                                                    noRows: "No questions found",
                                                    info: "Showing {start} to {end} of {rows} questions"
                                                }
                                            });
                                        }
                                    });
                                }
                            
                                // Edit button handler (example, implement your modal logic)
                                $(document).on('click', '.edit-btn', function () {
                                    const examId = $(this).data('exam-id');
                                    // Call your edit modal function here
                                    // editExamModal(examId);
                                    alert('Edit clicked for: ' + examId);
                                });
                            
                                fetchQuestions();
                            });
                            </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script src="/js/scripts.js"></script>
       
</body>

</html>